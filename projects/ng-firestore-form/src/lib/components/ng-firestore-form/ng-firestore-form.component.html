<form class="row" #firesoteForm="ngForm">
  <ng-container *ngFor="let control of controls" [ngSwitch]="control.type">
    <!-- prettier-ignore -->
    <div *ngIf="!control.hide" [class]=" getResponsiveClass('col', control.column) + ' ' + getResponsiveClass('offset', control.offset)">
      <!-- prettier-ignore -->
      <ng-container [ngTemplateOutlet]="controlLabel" [ngTemplateOutletContext]="{ control }"></ng-container>
      <!-- prettier-ignore -->
      <ng-container *ngSwitchCase="'email'" [ngTemplateOutlet]="emaiControl" [ngTemplateOutletContext]="{ control }"></ng-container>
      <!-- prettier-ignore -->
      <ng-container *ngSwitchCase="'text'" [ngTemplateOutlet]="textInputControl" [ngTemplateOutletContext]="{ control }"></ng-container>
      <!-- prettier-ignore -->
      <ng-container *ngSwitchCase="'number'" [ngTemplateOutlet]="numberInputControl" [ngTemplateOutletContext]="{ control }"></ng-container>
      <!-- prettier-ignore -->
      <ng-container *ngSwitchCase="'color'" [ngTemplateOutlet]="numberInputControl" [ngTemplateOutletContext]="{ control }"></ng-container>
      <!-- prettier-ignore -->
      <ng-container *ngSwitchCase="'date'" [ngTemplateOutlet]="numberInputControl" [ngTemplateOutletContext]="{ control }"></ng-container>
      <!-- prettier-ignore -->
      <ng-container *ngSwitchCase="'textarea'" [ngTemplateOutlet]="textareaControl" [ngTemplateOutletContext]="{ control }"></ng-container>
      <!-- prettier-ignore -->
      <ng-container *ngSwitchCase="'select'" [ngTemplateOutlet]="selectControl" [ngTemplateOutletContext]="{ control }"></ng-container>
      <!-- prettier-ignore -->
      <ng-container *ngSwitchCase="'radio'" [ngTemplateOutlet]="radioControl" [ngTemplateOutletContext]="{ control }"></ng-container>
      <!-- prettier-ignore -->
      <ng-container *ngSwitchCase="'check-box'" [ngTemplateOutlet]="checkBoxControl" [ngTemplateOutletContext]="{ control }"></ng-container>
      <!-- prettier-ignore -->
      <ng-container *ngSwitchCase="'multi-select'" [ngTemplateOutlet]="multiSelectControl" [ngTemplateOutletContext]="{ control }"></ng-container>
      <!-- prettier-ignore -->
      <ng-container *ngSwitchCase="'image'" [ngTemplateOutlet]="imageInputControl" [ngTemplateOutletContext]="{ control }"></ng-container>
      <!-- prettier-ignore -->
      <ng-container [ngTemplateOutlet]="validationMessage" [ngTemplateOutletContext]="{ control }"></ng-container>
    </div>
  </ng-container>
  <!-- prettier-ignore -->
  <!-- <div class="col-12">
    <button type="button" (click)="firesoteForm.resetForm(defaultValues)" class="btn btn-dark">Reset</button>
  </div> -->

  <ng-template #emaiControl let-control="control">
    <input
      type="email"
      #formControl="ngModel"
      autocomplete="off"
      [class.text-muted]="control.disabled"
      [class.is-invalid]="formControl.invalid && formControl.dirty"
      [class.is-valid]="formControl.valid && formControl.dirty"
      [disabled]="control.disabled"
      [required]="control.required"
      email
      [minlength]="control.min"
      [maxlength]="control.max"
      [defaultValue]="control.defaultValue"
      [ngModel]="control.defaultValue"
      class="form-control"
      [name]="control.name"
      [id]="control.id"
      [placeholder]="control.placeholder"
    />
  </ng-template>

  <ng-template #textInputControl let-control="control">
    <input
      type="text"
      #formControl="ngModel"
      autocomplete="off"
      [class.text-muted]="control.disabled"
      [class.is-invalid]="formControl.invalid && formControl.dirty"
      [class.is-valid]="formControl.valid && formControl.dirty"
      [disabled]="control.disabled"
      [required]="control.required"
      [minlength]="control.min"
      [pattern]="control.pattern"
      [maxlength]="control.max"
      [defaultValue]="control.defaultValue"
      [ngModel]="control.defaultValue"
      class="form-control"
      [name]="control.name"
      [id]="control.id"
      [placeholder]="control.placeholder"
    />
  </ng-template>

  <ng-template #numberInputControl let-control="control">
    <input
      [type]="control.type"
      #formControl="ngModel"
      autocomplete="off"
      [class.text-muted]="control.disabled"
      [class.is-invalid]="formControl.invalid && formControl.dirty"
      [class.is-valid]="formControl.valid && formControl.dirty"
      [disabled]="control.disabled"
      [required]="control.required"
      [min]="control.min"
      [max]="control.max"
      [defaultValue]="control.defaultValue"
      [ngModel]="control.defaultValue"
      class="form-control"
      [name]="control.name"
      [id]="control.id"
      [placeholder]="control.placeholder"
    />
  </ng-template>

  <ng-template #textareaControl let-control="control">
    <textarea
      #formControl="ngModel"
      autocomplete="off"
      [rows]="control.rows"
      [cols]="control.cols"
      [style.resize]="control.resize || 'none'"
      [class.text-muted]="control.disabled"
      [class.is-invalid]="formControl.invalid && formControl.dirty"
      [class.is-valid]="formControl.valid && formControl.dirty"
      [disabled]="control.disabled"
      [required]="control.required"
      [minlength]="control.min"
      [pattern]="control.pattern"
      [maxlength]="control.max"
      [defaultValue]="control.defaultValue"
      [ngModel]="control.defaultValue"
      class="form-control"
      [name]="control.name"
      [id]="control.id"
      [placeholder]="control.placeholder"
    ></textarea>
  </ng-template>

  <ng-template #selectControl let-control="control">
    <select
      #formControl="ngModel"
      autocomplete="off"
      [class.text-muted]="control.disabled"
      [class.is-invalid]="formControl.invalid && formControl.dirty"
      [class.is-valid]="formControl.valid && formControl.dirty"
      [disabled]="control.disabled"
      [required]="control.required"
      [minlength]="control.min"
      [pattern]="control.pattern"
      [maxlength]="control.max"
      [ngModel]="control.defaultValue"
      class="form-control"
      [name]="control.name"
      [id]="control.id"
    >
      <option value="" disabled>{{ control.placeholder }}</option>
      <ng-container *ngIf="control.dataProvider">
        <option
          *ngFor="let option of control.dataProvider.data"
          [value]="option[control.dataProvider.idField]"
        >
          {{ option[control.dataProvider.labelField] }}
        </option>
      </ng-container>
    </select>
  </ng-template>

  <ng-template #radioControl let-control="control">
    <div>
      <ng-container *ngIf="control.dataProvider">
        <ng-container *ngFor="let option of control.dataProvider.data">
          <div
            class="form-check"
            [class.form-check-inline]="control.isCheckInline"
          >
            <input
              class="form-check-input"
              type="radio"
              #formControl="ngModel"
              [ngModel]="control.defaultValue"
              [value]="option[control.dataProvider.idField]"
              [name]="control.name"
              [id]="control.id + '_' + option[control.dataProvider.idField]"
            />
            <label
              class="form-check-label"
              [for]="control.id + '_' + option[control.dataProvider.idField]"
            >
              {{ option[control.dataProvider.labelField] }}
            </label>
          </div>
        </ng-container>
      </ng-container>
    </div>
  </ng-template>

  <ng-template #checkBoxControl let-control="control">
    <div>
      <input
        type="hidden"
        [name]="control.name"
        [required]="control.required"
        ngModel
        [id]="control.id"
      />
      <ng-container *ngIf="control.dataProvider">
        <ng-container *ngFor="let option of control.dataProvider.data">
          <div
            class="form-check"
            [class.form-check-inline]="control.isCheckInline"
          >
            <input
              class="form-check-input"
              type="checkbox"
              (change)="
                onCheckBoxChange(
                  control,
                  $event,
                  option[control.dataProvider.idField]
                )
              "
              [value]="option[control.dataProvider.idField]"
              [checked]="option.selected"
              [id]="control.id + '_' + option[control.dataProvider.idField]"
            />
            <label
              class="form-check-label"
              [for]="control.id + '_' + option[control.dataProvider.idField]"
            >
              {{ option[control.dataProvider.labelField] }}
            </label>
          </div>
        </ng-container>
      </ng-container>
    </div>
    <!-- <pre>{{control|json}}</pre> -->
  </ng-template>

  <ng-template #multiSelectControl let-control="control">
    <select
      #formControl="ngModel"
      autocomplete="off"
      multiple
      [class.text-muted]="control.disabled"
      [class.is-invalid]="formControl.invalid && formControl.dirty"
      [class.is-valid]="formControl.valid && formControl.dirty"
      [disabled]="control.disabled"
      [required]="control.required"
      [minlength]="control.min"
      [pattern]="control.pattern"
      [maxlength]="control.max"
      [ngModel]="control.defaultValue"
      class="form-control"
      [name]="control.name"
      [id]="control.id"
    >
      <!-- <option value="" disabled>{{ control.placeholder }}</option> -->
      <ng-container *ngIf="control.dataProvider">
        <option
          *ngFor="let option of control.dataProvider.data"
          [value]="option[control.dataProvider.idField]"
        >
          {{ option[control.dataProvider.labelField] }}
        </option>
      </ng-container>
    </select>
  </ng-template>

  <ng-template #imageInputControl let-control="control">
    <div class="input-group">
      <input
        type="hidden"
        [name]="control.name"
        #formControl="ngModel"
        [ngModel]="control.defaultValue"
        [defaultValue]="control.defaultValue"
      />
      <input
        type="file"
        autocomplete="off"
        [class.text-muted]="control.disabled"
        [class.is-invalid]="formControl.invalid && formControl.dirty"
        [class.is-valid]="formControl.valid && formControl.dirty"
        [disabled]="control.disabled"
        [required]="control.required"
        [min]="control.min"
        [max]="control.max"
        [accept]="control.accept"
        (change)="onFileChange(control, $event, control.name, control.image)"
        class="form-control"
        [id]="control.id"
        [placeholder]="control.placeholder"
      />
      <button
        class="btn btn-outline-secondary"
        *ngIf="control.image"
        (click)="images[control.name].show = true"
      >
        Edit
      </button>
    </div>
    <div class="image-previewer" *ngIf="images[control.name]?.show">
      <div class="card shadow mt-3">
        <div class="card-body">
          <h6 class="card-title m-0 p-0 pb-2 text-center">
            <code>{{ control.label }}</code> Image Cropper
          </h6>
          <div style="width: 300px">
            <img
              [src]="images[control.name].image"
              style="width: 300px; height: 189px; object-fit: cover"
            />
            <image-cropper
              [imageBase64]="images[control.name].imageBase64"
              style="max-height: 230px;"
              [maintainAspectRatio]="true"
              [allowMoveImage]="true"
              [resizeToWidth]="300"
              [resizeToHeight]="189"
              [aspectRatio]="1 / 0.63"
              format="png"
              (imageCropped)="imageCropped($event, control.name)"
              (imageLoaded)="imageLoaded()"
              (cropperReady)="cropperReady()"
              (loadImageFailed)="loadImageFailed()"
            ></image-cropper>
          </div>
          <div class="d-flex mt-2">
            <button
              (click)="
                images[control.name].show = false;
                this.images[control.name].open = false
              "
              class="w-100 btn btn-danger ms-1 btn-sm"
            >
              Ok
            </button>
          </div>
        </div>
      </div>
    </div>
  </ng-template>

  <!-- prettier-ignore -->
  <ng-template #validationMessage let-formControl="formControl" let-control="control">
  <!-- prettier-ignore -->
  <small><div class="mb-1" [innerHTML]="getErrorMessage(control) || control?.help || '&nbsp'"></div></small>
</ng-template>

  <!-- prettier-ignore -->
  <ng-template #controlLabel let-control="control">
  <!-- prettier-ignore -->
  <label [class.text-muted]="control.disabled" [for]="control.id" class="form-label">{{ control.label }}<span class="text-danger ms-1 fw-bold" *ngIf="control.required">*</span></label>
</ng-template>
</form>

<!-- <pre>{{ firesoteForm.value | json }}</pre> -->
